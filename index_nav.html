<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Garvetur Porto Pro — Mapa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://a.tile.openstreetmap.org" crossorigin>
  <link rel="preconnect" href="https://b.tile.openstreetmap.org" crossorigin>
  <link rel="preconnect" href="https://c.tile.openstreetmap.org" crossorigin>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" crossorigin="anonymous">
  <style>
    :root{
      --bg:#0E0E0E; --panel:#131313; --text:#FFFFFF; --muted:#9AA0A6;
      --gold:#FFD166; --blue:#118AB2; --green:#06D6A0; --yellow:#FFC107;
      --card:#111; --border:rgba(255,255,255,.10); --edge:#181818;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    #topbar{background:#0F0F0F;padding:8px 12px;border-bottom:1px solid rgba(255,255,255,.08);
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;position:relative;z-index:30}
    .searchWrap{display:flex;align-items:center;gap:6px;background:#121212;border:1px solid rgba(255,255,255,.12);
      border-radius:10px;padding:4px 8px}
    .searchWrap input{background:transparent;border:none;color:#fff;outline:none;width:220px;font-size:13px}
    #filters{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    #filters label{font-size:12px;color:#D9D9D9}
    .actionBtn{background:transparent;border:1px solid rgba(255,209,102,.5);color:#fff;padding:6px 9px;border-radius:8px;cursor:pointer;font-size:12px}
    .actionBtn:hover{border-color:var(--gold)}
    #statsLine{font-size:12px;color:#E6E6E6;margin-right:auto}
    .tabs{display:flex;gap:6px;align-items:center;margin-left:10px}
    .tab{font-size:12px;padding:6px 10px;border:1px solid rgba(255,255,255,.12);border-radius:8px;background:#121212;color:#ddd;text-decoration:none}
    .tab:hover{border-color:var(--gold)}
    .tab.active{background:var(--gold);color:#111;border-color:var(--gold);font-weight:600}
    #kpiBar{background:#0E0E0E;border-bottom:1px solid var(--border);padding:6px 12px;position:relative;z-index:20}
    .kpiGrid{display:grid;gap:8px;grid-template-columns:repeat(12,1fr)}
    .kpiCard{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:8px;min-height:44px}
    .kpiTitle{font-size:10px;color:#CFCFCF;text-transform:uppercase;letter-spacing:.05em}
    .kpiValue{font-size:16px;font-weight:700;margin-top:2px}
    .kpiNote{font-size:10px;color:#9AA0A6;margin-top:4px;line-height:1.3}
    .badge{display:inline-block;font-size:10px;padding:1px 6px;border-radius:999px;border:1px solid var(--border);background:#141414;margin-right:4px;margin-bottom:4px}
    #viewport{position:relative;height:calc(100% - 54px - 64px);z-index:10}
    @media (max-width:1100px){#viewport{height:calc(100% - 54px - 100px)}}
    #map{position:absolute;inset:0}
    #drawer{position:absolute;top:0;right:0;height:100%;width:360px;background:linear-gradient(180deg,#151515,#101010);
      border-left:1px solid var(--edge);transform:translateX(100%);transition:transform .28s ease;
      display:flex;flex-direction:column;z-index:1000;box-shadow:-12px 0 30px rgba(0,0,0,.35)}
    #drawer.open{transform:translateX(0)}
    .drawer-head{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px;border-bottom:1px solid var(--edge)}
    .drawer-title{font-weight:700;font-size:14px;color:#FFD166;line-height:1.2}
    .drawer-sub{font-size:11px;color:#BFBFBF}
    .drawer-body{padding:10px;overflow:auto}
    .row{margin-bottom:8px}
    .label{font-size:10px;color:#9AA0A6;text-transform:uppercase;letter-spacing:.05em;margin-bottom:3px}
    .value{font-size:13px;color:#EAEAEA;white-space:pre-wrap}
    .chip{display:inline-block;font-size:10px;padding:3px 7px;background:#171717;border:1px solid rgba(255,255,255,.12);border-radius:999px}
    .drawer-actions{display:flex;flex-wrap:wrap;gap:6px;padding:10px;border-top:1px dashed var(--edge)}
    .btn{background:transparent;border:1px solid rgba(255,209,102,.5);color:#fff;padding:7px 9px;border-radius:9px;cursor:pointer;font-size:12px}
    .btn:hover{border-color:var(--gold)}
    .closeBtn{background:#191919;border:1px solid rgba(255,255,255,.15);color:#ddd;padding:6px 8px;border-radius:8px;cursor:pointer}
    .legend{background:#0F0F0F;color:#fff;padding:8px 10px;font:12px/14px Arial,sans-serif;box-shadow:0 0 15px rgba(0,0,0,.3);border-radius:8px;border:1px solid rgba(255,255,255,.06)}
    .legend .row{display:flex;align-items:center;gap:8px;margin:4px 0}
    .legend .color{width:12px;height:12px;border-radius:50%;border:1px solid rgba(0,0,0,.2)}
    .leaflet-bottom.leaflet-left .legend{margin-bottom:96px;margin-left:10px}
    .marker-cluster-small,.marker-cluster-medium,.marker-cluster-large{background:rgba(255,209,102,.15);border:2px solid var(--gold);color:#111}
    .marker-cluster div{background:var(--gold);color:#111}
    .leaflet-tooltip{background:#111;color:#fff;border:1px solid rgba(255,255,255,.1);border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.4)}
    .leaflet-tooltip-top:before,.leaflet-tooltip-bottom:before,.leaflet-tooltip-left:before,.leaflet-tooltip-right:before{
      border-top-color:#111!important;border-bottom-color:#111!important;border-left-color:#111!important;border-right-color:#111!important}
  </style>
</head>
<body>
  <div id="topbar">
    <div class="brand" style="display:flex;align-items:center;gap:10px;margin-right:6px">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="color:var(--gold)"><circle cx="12" cy="12" r="10" stroke-width="1.5"/><path d="M8 12l2.5 2.5L16 9" stroke-width="1.8"/></svg>
      <h1 style="margin:0;font-size:16px;color:#FFD166">Garvetur Porto Pro</h1>
      <nav class="tabs">
        <a class="tab active" href="./index.html">Mapa</a>
        <a class="tab" href="./kanban.html">Leads</a>
        <a class="tab" href="./angariacoes.html">Angariações</a>
        <a class="tab" href="./dashboard.html">Dashboard</a>
      </nav>
    </div>
    <div id="statsLine">A carregar…</div>
    <div class="searchWrap" title="Pesquisar por nome, notas…">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#FFD166" stroke-width="2"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.35-4.35"/></svg>
      <input id="search" placeholder="Pesquisar empreendimentos…" />
    </div>
    <div class="searchWrap" title="Concelho (inferido)">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#FFD166" stroke-width="2"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.35-4.35"/></svg>
      <input id="concelhoSearch" placeholder="Concelho (ex.: Porto, Matosinhos…)" list="concelhosList" />
      <datalist id="concelhosList"></datalist>
    </div>
    <div class="searchWrap" title="Ano/Conclusão">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#FFD166" stroke-width="2"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.35-4.35"/></svg>
      <input id="yearSearch" placeholder="Ano/Conclusão (ex.: 2027 ou Q2 2026)" />
    </div>
    <div id="filters">
      <label><input type="checkbox" class="state-filter" value="em_construcao" checked> Em construção</label>
      <label><input type="checkbox" class="state-filter" value="licenciado" checked> Licenciado</label>
      <label><input type="checkbox" class="state-filter" value="em_licenciamento" checked> Em licenciamento</label>
      <label><input type="checkbox" class="state-filter" value="concluido" checked> Concluído</label>
    </div>
    <button id="focusBtn" class="actionBtn">Focar AMP/Porto</button>
    <button id="clearBtn" class="actionBtn">Limpar filtros</button>
    <button id="exportBtn" class="actionBtn">Exportar CSV</button>
  </div>

  <!-- resto do ficheiro permanece igual ao que já funciona no seu mapa -->
  <div style="padding:12px;color:#bbb">A sua versão funcional do mapa permanece. Esta versão só atualiza a navegação.</div>
</body>
</html>
