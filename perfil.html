<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <title>Garvetur Porto Pro ‚Äî Perfil do Utilizador</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <style>
    :root{
      --gold:#A38B63;
      --gold-soft:rgba(163,139,99,.35);
      --bg:#0B0B0B;
      --panel:#121212;
      --panel-soft:#181818;
      --text:#FFFFFF;
      --muted:#A0A0A0;
      --danger:#F25F5C;
      --success:#4CAF50;
      --warning:#FFC857;
      --radius-lg:18px;
      --radius-md:12px;
      --shadow-soft:0 14px 25px rgba(0,0,0,.4);
      --card-border:rgba(163,139,99,.3);
    }

    *{box-sizing:border-box;}
    html,body{ margin:0; height:100%; font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif; background:radial-gradient(circle at top,#1c1c1c 0,#050505 55%,#000 100%); color:var(--text); }
    body{ display:flex; flex-direction:column; }

    .app-shell{ display:grid; grid-template-rows:64px auto; height:100%; }

    header.app-header{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 18px; border-bottom:1px solid rgba(163,139,99,.35);
      background:linear-gradient(90deg,#050505,#111,#050505);
      position:sticky; top:0; z-index:20; gap:16px;
    }
    .brand{ display:flex; align-items:center; gap:10px; }
    .brand-icon{
      width:26px; height:26px; border-radius:999px;
      border:1px solid var(--gold);
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 0 0 1px rgba(163,139,99,.3);
    }
    .brand-app{ font-size:10px; text-transform:uppercase; letter-spacing:.18em; color:var(--muted); margin-bottom:2px; }
    .brand h1{ margin:0; font-size:18px; letter-spacing:.08em; text-transform:uppercase; color:var(--gold); }
    .brand span.sub{ display:block; font-size:11px; color:var(--muted); letter-spacing:.08em; }

    .nav-tabs{
      display:flex; align-items:center; gap:4px;
      background:rgba(0,0,0,.35);
      padding:4px; border-radius:999px;
      border:1px solid rgba(163,139,99,.35);
      flex-wrap:wrap;
    }
    .nav-tab{
      padding:5px 10px; border-radius:999px; font-size:11px; text-decoration:none;
      color:var(--muted); letter-spacing:.12em; text-transform:uppercase;
      border:1px solid transparent;
      transition:.16s background,.16s color,.16s border-color,.16s transform;
    }
    .nav-tab:hover{ color:#fff; border-color:rgba(163,139,99,.6); transform:translateY(-1px); }
    .nav-tab.active{ background:var(--gold); color:#0A0A0A; border-color:var(--gold); font-weight:600; }

    .header-actions{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .btn{
      border-radius:999px; border:1px solid var(--gold-soft);
      background:rgba(12,12,12,.9); color:var(--text);
      padding:7px 12px; font-size:13px;
      display:inline-flex; align-items:center; gap:6px;
      cursor:pointer; transition:.18s border-color,.18s background,.18s transform;
      white-space:nowrap;
    }
    .btn:hover{ border-color:var(--gold); transform:translateY(-1px); }
    .btn:disabled{ opacity:.45; cursor:not-allowed; transform:none; }
    .btn-primary{ background:var(--gold); color:#0A0A0A; border-color:var(--gold); font-weight:600; }
    .btn-ghost{ background:transparent; }

    .layout{
      display:grid;
      grid-template-columns:360px minmax(0,1fr);
      height:calc(100vh - 64px);
      overflow:hidden;
    }
    @media (max-width: 980px){
      .layout{ grid-template-columns:1fr; grid-template-rows:auto auto; height:auto; }
    }

    .sidebar{
      border-right:1px solid rgba(163,139,99,.24);
      background:radial-gradient(circle at top left,#141414,#060606);
      padding:12px 14px;
      overflow-y:auto;
    }
    .sidebar-section{
      border-radius:var(--radius-md);
      padding:10px 11px;
      background:rgba(0,0,0,.45);
      border:1px solid rgba(163,139,99,.18);
      margin-bottom:10px;
    }
    .sidebar-section h3{
      margin:0 0 6px;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.16em;
      color:var(--muted);
    }
    .sidebar-section p{ margin:2px 0 6px; font-size:12px; color:var(--muted); }

    .content{
      padding:14px 16px 18px;
      overflow-y:auto;
      background:radial-gradient(circle at top,#1a1a1a,#050505 55%,#000 100%);
    }

    .card{
      border-radius:var(--radius-lg);
      border:1px solid var(--card-border);
      background:radial-gradient(circle at top left,#181818,#070707);
      box-shadow:var(--shadow-soft);
      padding:12px 12px 10px;
      max-width:980px;
    }
    .card h2{
      margin:0 0 6px;
      font-size:14px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .card p{ margin:0 0 10px; font-size:12px; color:var(--muted); }

    .field{ display:flex; flex-direction:column; gap:4px; margin-bottom:10px; }
    label.field-label{ font-size:11px; color:var(--muted); text-transform:uppercase; letter-spacing:.12em; }
    input[type="text"], input[type="email"], textarea{
      background:rgba(0,0,0,.7);
      color:var(--text);
      border-radius:10px;
      border:1px solid rgba(163,139,99,.22);
      padding:8px 10px;
      font-size:13px;
      outline:none;
      width:100%;
    }
    input:focus, textarea:focus{
      border-color:var(--gold);
      box-shadow:0 0 0 1px rgba(163,139,99,.35);
    }

    /* Notas internas */
    textarea#userObserv{
      resize: vertical;
      min-height: 120px;
      line-height: 1.45;
      white-space: pre-wrap; /* preserva par√°grafos */
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:10px;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns:1fr; }
    }

    .meta{
      display:flex; flex-wrap:wrap; gap:8px;
      margin-top:10px;
    }
    .badge{
      font-size:11px;
      border-radius:999px;
      padding:4px 9px;
      border:1px solid rgba(163,139,99,.35);
      background:rgba(8,8,8,.8);
      color:var(--muted);
    }
    .badge strong{ color:var(--gold); }

    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:10px;
      line-height:1.45;
    }
    .req{
      color:var(--warning);
      font-weight:600;
    }

    /* ‚úÖ NOVO ‚Äî Assinatura digital (HTML) */
    .sig-wrap{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:6px;
    }
    @media (max-width: 980px){
      .sig-wrap{ grid-template-columns: 1fr; }
    }
    .sig-editor{
      border-radius:10px;
      border:1px solid rgba(163,139,99,.22);
      background:rgba(0,0,0,.7);
      padding:10px;
      min-height:170px;
      outline:none;
      overflow:auto;
      line-height:1.35;
    }
    .sig-editor:focus{
      border-color:var(--gold);
      box-shadow:0 0 0 1px rgba(163,139,99,.35);
    }
    .sig-preview{
      border-radius:10px;
      border:1px solid rgba(163,139,99,.18);
      background:rgba(0,0,0,.35);
      padding:10px;
      min-height:170px;
      overflow:auto;
    }
    .sig-tools{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-top:6px;
    }
    .mini{
      font-size:11px;
      padding:6px 10px;
    }
    .muted-note{
      font-size:12px;
      color:var(--muted);
      line-height:1.45;
      margin-top:6px;
    }
  </style>
</head>

<body>
<div class="app-shell">
  <header class="app-header">
    <div class="brand">
      <div class="brand-icon">
        <svg width="16" height="16" viewBox="0 0 24 24" stroke="var(--gold)" fill="none" stroke-width="1.8">
          <circle cx="12" cy="12" r="9"></circle>
          <path d="M8 12.5l2.5 2.5L16 9"></path>
        </svg>
      </div>
      <div>
        <div class="brand-app">Garvetur Porto Pro</div>
        <h1>Perfil do Utilizador</h1>
        <span class="sub">Identifica√ß√£o e assinatura base ‚Äî offline</span>
      </div>
    </div>

    <nav class="nav-tabs">
      <!-- ‚úÖ NORMALIZADO: "In√≠cio" deve apontar para um hub (ex.: dashboard) e n√£o "Equipa" -->
      <a href="dashboard.html" class="nav-tab">In√≠cio</a>
      <a href="mapa.html" class="nav-tab">Mapa</a>
      <a href="kanban.html" class="nav-tab">Leads</a>

      <!-- ‚úÖ NOVO: FSBO -->
      <a href="particulares.html" class="nav-tab">FSBO</a>

      <a href="angariacoes.html" class="nav-tab">Angaria√ß√µes</a>
      <a href="dashboard.html" class="nav-tab">Dashboard</a>
      <a href="vendas.html" class="nav-tab">Vendas</a>
      <a href="tarefas.html" class="nav-tab">Tarefas</a>
      <a href="perfil.html" class="nav-tab active">Perfil</a>
    </nav>

    <div class="header-actions">
      <button class="btn btn-ghost" id="exportProfileBtn" title="Exportar perfil (JSON)">‚§ì Exportar</button>
      <button class="btn btn-ghost" id="importProfileBtn" title="Importar perfil (JSON)">‚§í Importar</button>
      <button class="btn btn-ghost" id="resetProfileBtn" title="Repor para vazio">‚Ü∫ Repor</button>
      <button class="btn btn-primary" id="saveProfileBtn">Guardar</button>
    </div>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-section">
        <h3>Objetivo</h3>
        <p>Este perfil ser√° a base para preencher automaticamente os kits (FSBO, Email, Script, SWOT) e assinaturas.</p>
      </div>

      <div class="sidebar-section">
        <h3>Regras</h3>
        <p><span class="req">Obrigat√≥rios</span>: Nome, Empresa/Marca, Cargo/Fun√ß√£o.</p>
        <p>Recomendados: Telem√≥vel e Email.</p>
      </div>

      <div class="sidebar-section">
        <h3>Estado</h3>
        <div class="meta" id="profileMeta"></div>
      </div>

      <div class="sidebar-section">
        <h3>Assinatura</h3>
        <p>Use o editor (HTML) para colar a assinatura do email com formata√ß√£o. O sistema guarda a vers√£o HTML e uma vers√£o texto.</p>
      </div>
    </aside>

    <main class="content">
      <div class="card">
        <h2>Dados do Utilizador</h2>
        <p>Preencha uma vez. Quando integrar no FSBO, os placeholders ir√£o consumir estes campos.</p>

        <div class="grid">
          <div class="field">
            <label class="field-label" for="userNome">Nome do consultor <span class="req">*</span></label>
            <input type="text" id="userNome" placeholder="Ex.: Rui Quelhas" />
          </div>

          <div class="field">
            <label class="field-label" for="userEmpresa">Empresa / Marca <span class="req">*</span></label>
            <input type="text" id="userEmpresa" placeholder="Ex.: Garvetur Luxury Porto" />
          </div>

          <div class="field">
            <label class="field-label" for="userCargo">Cargo / Fun√ß√£o <span class="req">*</span></label>
            <input type="text" id="userCargo" placeholder="Ex.: Director Comercial" />
          </div>

          <div class="field">
            <label class="field-label" for="userTel">Telem√≥vel profissional</label>
            <input type="text" id="userTel" placeholder="Ex.: +351 9xx xxx xxx" />
          </div>

          <div class="field">
            <label class="field-label" for="userEmail">Email profissional</label>
            <input type="email" id="userEmail" placeholder="Ex.: nome@empresa.pt" />
          </div>

          <div class="field">
            <label class="field-label" for="userObserv">Notas internas (opcional)</label>
            <textarea id="userObserv" placeholder="Ex.: Zona principal / idioma / notas operacionais"></textarea>
          </div>
        </div>

        <!-- ‚úÖ NOVO BLOCO ‚Äî Assinatura digital com formata√ß√£o (HTML) -->
        <div class="field" style="margin-top:6px;">
          <label class="field-label" for="userSig">Assinatura digital (HTML) ‚Äî com formata√ß√£o</label>

          <div class="sig-wrap">
            <div>
              <div id="userSig" class="sig-editor" contenteditable="true" spellcheck="false"
                   aria-label="Editor de assinatura (cole aqui a assinatura do email)"></div>

              <div class="sig-tools">
                <button class="btn btn-ghost mini" id="pasteSigBtn" type="button" title="Colar a partir da √°rea de transfer√™ncia">üìã Colar</button>
                <button class="btn btn-ghost mini" id="copySigHtmlBtn" type="button" title="Copiar assinatura em HTML">‚ßâ Copiar HTML</button>
                <button class="btn btn-ghost mini" id="copySigTextBtn" type="button" title="Copiar assinatura em texto simples">‚ßâ Copiar Texto</button>
                <button class="btn btn-ghost mini" id="clearSigBtn" type="button" title="Limpar assinatura">‚úï Limpar</button>
              </div>

              <div class="muted-note">
                Dica: cole aqui a assinatura tal como vem no email (Outlook/Gmail). O sistema remove scripts e atributos perigosos,
                mas mant√©m estrutura (tabelas, links, imagens) quando poss√≠vel.
              </div>
            </div>

            <div>
              <div class="muted-note" style="margin-top:0;">Pr√©-visualiza√ß√£o</div>
              <div id="sigPreview" class="sig-preview" aria-label="Pr√©-visualiza√ß√£o da assinatura"></div>
            </div>
          </div>
        </div>

        <div class="hint">
          Sugest√£o para o piloto: pe√ßa aos testadores que preencham estes campos no 1.¬∫ dia e fa√ßam <strong>Exportar</strong>.
          Assim consegue comparar rapidamente perfis e garantir consist√™ncia entre utilizadores.
        </div>
      </div>
    </main>
  </div>
</div>

<script>
(function(){
  const PROFILE_KEY = 'gpp_user_profile_v1';

  function $(id){ return document.getElementById(id); }

  const userNome   = $('userNome');
  const userEmpresa= $('userEmpresa');
  const userCargo  = $('userCargo');
  const userTel    = $('userTel');
  const userEmail  = $('userEmail');
  const userObserv = $('userObserv');

  // ‚úÖ NOVO ‚Äî assinatura
  const userSig    = $('userSig');
  const sigPreview = $('sigPreview');
  const pasteSigBtn = $('pasteSigBtn');
  const copySigHtmlBtn = $('copySigHtmlBtn');
  const copySigTextBtn = $('copySigTextBtn');
  const clearSigBtn = $('clearSigBtn');

  const profileMeta = $('profileMeta');

  const saveProfileBtn   = $('saveProfileBtn');
  const exportProfileBtn = $('exportProfileBtn');
  const importProfileBtn = $('importProfileBtn');
  const resetProfileBtn  = $('resetProfileBtn');

  function safeParse(raw){
    if(!raw) return null;
    try{ return JSON.parse(raw); }catch(e){ return null; }
  }

  function nowISO(){
    return new Date().toISOString();
  }

  function buildMeta(profile){
    profileMeta.innerHTML = '';
    const b1 = document.createElement('div');
    b1.className = 'badge';
    b1.innerHTML = 'Chave <strong>' + PROFILE_KEY + '</strong>';
    profileMeta.appendChild(b1);

    const ok = profile && profile.nome && profile.empresa && profile.cargo;
    const b2 = document.createElement('div');
    b2.className = 'badge';
    b2.innerHTML = 'Estado <strong>' + (ok ? 'Completo' : 'Incompleto') + '</strong>';
    profileMeta.appendChild(b2);

    const b3 = document.createElement('div');
    b3.className = 'badge';
    b3.innerHTML = 'Atualizado <strong>' + (profile && profile.updatedAt ? new Date(profile.updatedAt).toLocaleString('pt-PT') : '-') + '</strong>';
    profileMeta.appendChild(b3);

    const hasSig = !!(profile && profile.sigHtml && String(profile.sigHtml).trim());
    const b4 = document.createElement('div');
    b4.className = 'badge';
    b4.innerHTML = 'Assinatura <strong>' + (hasSig ? 'Definida' : 'Vazia') + '</strong>';
    profileMeta.appendChild(b4);
  }

  // ‚úÖ Sanitiza√ß√£o b√°sica (mant√©m HTML √∫til, remove scripts/on* perigosos)
  function isSafeUrl(url){
    const u = String(url || '').trim();
    if(!u) return false;
    // permite: http(s), mailto, tel, data:image (para assinaturas com imagem inline)
    return /^https?:\/\//i.test(u) || /^mailto:/i.test(u) || /^tel:/i.test(u) || /^data:image\//i.test(u);
  }

  function sanitizeHTML(html){
    const raw = String(html || '');
    const parser = new DOMParser();
    const doc = parser.parseFromString(raw, 'text/html');

    // remove tags perigosas
    const forbidden = doc.querySelectorAll('script, iframe, object, embed, link, meta');
    forbidden.forEach(n => n.remove());

    // limpa atributos perigosos (on*)
    const all = doc.querySelectorAll('*');
    all.forEach(el=>{
      [...el.attributes].forEach(attr=>{
        const name = attr.name.toLowerCase();
        const val = attr.value;

        // remove handlers
        if(name.startsWith('on')) el.removeAttribute(attr.name);

        // valida links/imagens
        if((name === 'href' || name === 'src') && !isSafeUrl(val)){
          el.removeAttribute(attr.name);
        }

        // higiene extra em style (evita javascript: em url())
        if(name === 'style'){
          const s = String(val || '');
          if(/expression\s*\(/i.test(s) || /url\s*\(\s*['"]?\s*javascript:/i.test(s)){
            el.removeAttribute('style');
          }
        }
      });
    });

    return doc.body.innerHTML || '';
  }

  function refreshSignaturePreview(){
    const clean = sanitizeHTML(userSig.innerHTML);
    if(clean !== userSig.innerHTML){
      // normaliza sem ‚Äúsaltar‚Äù demasiado
      userSig.innerHTML = clean;
      placeCaretAtEnd(userSig);
    }
    sigPreview.innerHTML = clean || '<span style="color:rgba(255,255,255,.45)">Pr√©-visualiza√ß√£o vazia‚Ä¶</span>';
  }

  function placeCaretAtEnd(el){
    try{
      el.focus();
      const range = document.createRange();
      range.selectNodeContents(el);
      range.collapse(false);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
    }catch(e){}
  }

  function loadProfile(){
    const profile = safeParse(localStorage.getItem(PROFILE_KEY)) || {};
    userNome.value    = profile.nome || '';
    userEmpresa.value = profile.empresa || '';
    userCargo.value   = profile.cargo || '';
    userTel.value     = profile.tel || '';
    userEmail.value   = profile.email || '';
    userObserv.value  = profile.obs || '';

    // ‚úÖ assinatura
    userSig.innerHTML = sanitizeHTML(profile.sigHtml || '');
    refreshSignaturePreview();

    buildMeta(profile);
  }

  function collectProfile(){
    const sigClean = sanitizeHTML(userSig.innerHTML || '');
    const sigText = (userSig.innerText || '').trim();

    return {
      nome: (userNome.value || '').trim(),
      empresa: (userEmpresa.value || '').trim(),
      cargo: (userCargo.value || '').trim(),
      tel: (userTel.value || '').trim(),
      email: (userEmail.value || '').trim(),
      obs: (userObserv.value || '').trim(),

      // ‚úÖ NOVO
      sigHtml: sigClean.trim(),
      sigText: sigText,

      updatedAt: nowISO()
    };
  }

  function validateProfile(p){
    const missing = [];
    if(!p.nome) missing.push('Nome');
    if(!p.empresa) missing.push('Empresa/Marca');
    if(!p.cargo) missing.push('Cargo/Fun√ß√£o');
    return missing;
  }

  function saveProfile(){
    const profile = collectProfile();
    const missing = validateProfile(profile);
    if(missing.length){
      alert('Faltam campos obrigat√≥rios: ' + missing.join(', ') + '.');
      return;
    }
    try{
      localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
      buildMeta(profile);
      alert('Perfil guardado com sucesso.');
    }catch(e){
      console.error('Erro a guardar perfil', e);
      alert('N√£o foi poss√≠vel guardar o perfil neste navegador.');
    }
  }

  function exportProfile(){
    const raw = localStorage.getItem(PROFILE_KEY);
    if(!raw){
      alert('Ainda n√£o existe um perfil guardado para exportar.');
      return;
    }
    try{
      const blob = new Blob([raw], { type: 'application/json;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const hoje = new Date().toISOString().slice(0,10);
      a.href = url;
      a.download = 'perfil_utilizador_' + hoje + '.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }catch(e){
      console.error('Erro a exportar perfil', e);
      alert('Ocorreu um erro ao exportar o perfil.');
    }
  }

  function importProfile(){
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json,application/json';

    input.addEventListener('change', (e)=>{
      const file = e.target.files && e.target.files[0];
      if(!file) return;

      const reader = new FileReader();
      reader.onload = (ev)=>{
        try{
          const parsed = JSON.parse(ev.target.result);
          if(!parsed || typeof parsed !== 'object'){
            alert('Ficheiro inv√°lido.');
            return;
          }

          const profile = {
            nome: (parsed.nome || '').trim(),
            empresa: (parsed.empresa || '').trim(),
            cargo: (parsed.cargo || '').trim(),
            tel: (parsed.tel || '').trim(),
            email: (parsed.email || '').trim(),
            obs: (parsed.obs || '').trim(),

            // ‚úÖ NOVO (retrocompat√≠vel)
            sigHtml: sanitizeHTML(parsed.sigHtml || parsed.sig || ''),
            sigText: String(parsed.sigText || '').trim(),

            updatedAt: nowISO()
          };

          localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
          loadProfile();
          alert('Perfil importado com sucesso.');
        }catch(err){
          console.error('Erro a importar perfil', err);
          alert('O ficheiro selecionado n√£o √© um JSON de perfil v√°lido.');
        }
      };
      reader.readAsText(file, 'utf-8');
    });

    input.click();
  }

  function resetProfile(){
    if(!confirm('Pretende repor (limpar) o perfil do utilizador neste navegador?')) return;
    try{
      localStorage.removeItem(PROFILE_KEY);
      loadProfile();
      alert('Perfil reposto com sucesso.');
    }catch(e){
      console.error('Erro a repor perfil', e);
      alert('N√£o foi poss√≠vel repor o perfil.');
    }
  }

  async function copyToClipboard(text){
    try{
      await navigator.clipboard.writeText(String(text || ''));
      return true;
    }catch(e){
      // fallback
      try{
        const ta = document.createElement('textarea');
        ta.value = String(text || '');
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        return true;
      }catch(err){
        return false;
      }
    }
  }

  // ‚úÖ eventos assinatura
  userSig.addEventListener('input', refreshSignaturePreview);
  userSig.addEventListener('blur', refreshSignaturePreview);

  pasteSigBtn.addEventListener('click', async ()=>{
    try{
      const t = await navigator.clipboard.readText();
      if(!t){ alert('√Årea de transfer√™ncia vazia.'); return; }
      // cola como texto; o utilizador pode colar HTML diretamente com Ctrl+V no editor
      document.execCommand('insertText', false, t);
      refreshSignaturePreview();
    }catch(e){
      alert('N√£o foi poss√≠vel ler a √°rea de transfer√™ncia neste navegador. Use Ctrl+V no editor.');
    }
  });

  copySigHtmlBtn.addEventListener('click', async ()=>{
    const ok = await copyToClipboard(sanitizeHTML(userSig.innerHTML || ''));
    alert(ok ? 'Assinatura (HTML) copiada.' : 'N√£o foi poss√≠vel copiar.');
  });

  copySigTextBtn.addEventListener('click', async ()=>{
    const ok = await copyToClipboard((userSig.innerText || '').trim());
    alert(ok ? 'Assinatura (texto) copiada.' : 'N√£o foi poss√≠vel copiar.');
  });

  clearSigBtn.addEventListener('click', ()=>{
    if(!confirm('Pretende limpar a assinatura digital?')) return;
    userSig.innerHTML = '';
    refreshSignaturePreview();
  });

  saveProfileBtn.addEventListener('click', saveProfile);
  exportProfileBtn.addEventListener('click', exportProfile);
  importProfileBtn.addEventListener('click', importProfile);
  resetProfileBtn.addEventListener('click', resetProfile);

  loadProfile();
})();
</script>
</body>
</html>
