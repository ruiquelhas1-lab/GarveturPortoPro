<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <title>Garvetur Porto Pro — Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --gold:#A38B63;
      --gold-soft:rgba(163,139,99,.35);
      --bg:#0B0B0B;
      --panel:#151515;
      --panel-soft:#1C1C1C;
      --text:#FFFFFF;
      --muted:#A0A0A0;
      --border:rgba(255,255,255,.14);
      --shadow-soft:0 22px 40px rgba(0,0,0,.7);
      --radius-lg:20px;
      --radius-md:14px;
      --danger:#E53935;
      --success:#4CAF50;
    }

    *{box-sizing:border-box;}
    html,body{
      margin:0;
      height:100%;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:radial-gradient(circle at top,#1c1c1c 0,#050505 55%,#000 100%);
      color:var(--text);
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 18px;
      border-bottom:1px solid rgba(163,139,99,.35);
      background:linear-gradient(90deg,#050505,#111,#050505);
      gap:14px;
      flex-wrap:wrap;
    }
    .brand{display:flex;align-items:center;gap:10px;}
    .brand-icon{
      width:30px;height:30px;border-radius:999px;border:1px solid var(--gold);
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 0 0 1px rgba(163,139,99,.35);
    }
    .brand h1{
      margin:0;font-size:18px;letter-spacing:.08em;text-transform:uppercase;color:var(--gold);
    }
    .brand span.sub{
      display:block;font-size:11px;color:var(--muted);letter-spacing:.14em;text-transform:uppercase;
    }
    .badge{
      font-size:11px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(163,139,99,.45);
      color:var(--muted);
      letter-spacing:.12em;
      text-transform:uppercase;
      background:rgba(0,0,0,.35);
    }

    main{padding:18px 18px 20px;}
    .hero{
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg,#171717,#050505);
      border:1px solid var(--gold-soft);
      box-shadow:var(--shadow-soft);
      padding:14px 16px;
      margin-bottom:14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .hero h2{
      margin:0 0 6px;
      font-size:16px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:#f5f5f5;
    }
    .hero p{
      margin:0;
      font-size:12px;
      color:var(--muted);
      line-height:1.55;
      max-width:820px;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:12px;
    }
    @media (max-width:1100px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media (max-width:720px){ .grid{grid-template-columns:1fr;} }

    .card{
      border-radius:var(--radius-lg);
      background:linear-gradient(145deg,#181818,#0C0C0C);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:var(--shadow-soft);
      padding:12px 12px 11px;
      display:flex;
      flex-direction:column;
      gap:8px;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at top left,rgba(163,139,99,.12),transparent 55%);
      opacity:0;
      transition:.25s opacity;
      pointer-events:none;
    }
    .card:hover::before{opacity:1;}

    .card-header{display:flex;justify-content:space-between;align-items:flex-start;gap:8px;}
    .card-title{
      margin:0;
      font-size:14px;
      text-transform:uppercase;
      letter-spacing:.14em;
      color:#f0f0f0;
    }
    .card-badge{
      font-size:10px;
      padding:2px 7px;
      border-radius:999px;
      border:1px solid rgba(163,139,99,.55);
      text-transform:uppercase;
      letter-spacing:.12em;
      color:var(--gold);
      background:rgba(0,0,0,.7);
      white-space:nowrap;
    }
    .card-body{font-size:12px;color:var(--muted);line-height:1.5;}
    .card-footer{
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .btn-xs{
      border-radius:999px;
      padding:6px 10px;
      border:1px solid rgba(163,139,99,.6);
      background:rgba(0,0,0,.8);
      color:var(--gold);
      font-size:11px;
      text-decoration:none;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      transition:.18s background,.18s color,.18s border-color,.18s transform;
    }
    .btn-xs.primary{
      background:var(--gold);
      color:#0A0A0A;
      border-color:var(--gold);
      font-weight:600;
    }
    .btn-xs.danger{
      border-color:rgba(229,57,53,.85);
      color:#ffb4b4;
      background:rgba(0,0,0,.85);
    }
    .btn-xs.ghost{
      border-color:rgba(255,255,255,.14);
      color:rgba(255,255,255,.65);
      background:rgba(0,0,0,.55);
    }
    .btn-xs:hover{transform:translateY(-1px);border-color:var(--gold);}
    .hint{font-size:11px;color:var(--muted);}

    /* Bloqueio/Login */
    .lock{
      position:fixed;
      inset:0;
      z-index:9999;
      background:radial-gradient(circle at top, rgba(0,0,0,.55), rgba(0,0,0,.92));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .lock-card{
      width:min(520px, 96vw);
      border-radius:18px;
      border:1px solid rgba(163,139,99,.35);
      background:linear-gradient(145deg,#111,#070707);
      box-shadow:0 22px 40px rgba(0,0,0,.75);
      padding:14px 14px 12px;
    }
    .lock-title{
      margin:0 0 6px;
      font-size:14px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:var(--gold);
    }
    .lock-sub{
      margin:0 0 10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.5;
    }
    .lock-row{display:flex;gap:8px;flex-wrap:wrap;}
    .lock input{
      flex:1;
      min-width:200px;
      border-radius:12px;
      border:1px solid rgba(163,139,99,.28);
      background:rgba(0,0,0,.65);
      color:#fff;
      padding:10px 12px;
      outline:none;
      font-size:14px;
    }
    .lock input:focus{border-color:var(--gold); box-shadow:0 0 0 1px rgba(163,139,99,.35);}
    .lock button{
      border-radius:12px;
      border:1px solid rgba(163,139,99,.55);
      background:var(--gold);
      color:#0A0A0A;
      padding:10px 12px;
      cursor:pointer;
      font-weight:700;
    }
    .lock-err{
      margin-top:8px;
      font-size:12px;
      color:#ffb4b4;
      display:none;
    }
    .lock-mini{
      margin-top:10px;
      font-size:11px;
      color:rgba(255,255,255,.35);
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }
    .mini-link{
      color:rgba(255,255,255,.45);
      text-decoration:none;
      border-bottom:1px dotted rgba(255,255,255,.25);
    }
    .mini-link:hover{color:#fff;border-bottom-color:#fff;}

    /* === Gestão de Licença (Admin) — bloco interno === */
    .kv{
      display:grid;
      grid-template-columns:140px 1fr;
      gap:6px 10px;
      padding:10px 10px 9px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.45);
    }
    .kv .k{
      font-size:11px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.12em;
    }
    .kv .v{
      font-size:12px;
      color:#fff;
      word-break:break-all;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 9px;
      border-radius:999px;
      font-size:11px;
      border:1px solid rgba(255,255,255,.14);
      color:rgba(255,255,255,.75);
      background:rgba(0,0,0,.55);
      white-space:nowrap;
    }
    .pill.ok{ border-color: rgba(76,175,80,.75); color:#A5D6A7; }
    .pill.warn{ border-color: rgba(255,200,87,.75); color:#FFE0A6; }
    .pill.bad{ border-color: rgba(229,57,53,.75); color:#FFB4B4; }

    .lic-actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .lic-actions-left{ display:flex; gap:8px; flex-wrap:wrap; }
    .lic-note{
      font-size:11px;
      color:rgba(255,255,255,.45);
      line-height:1.45;
    }
  </style>
</head>
<body>

<!-- LOGIN OVERLAY -->
<div id="lock" class="lock" aria-modal="true" role="dialog">
  <div class="lock-card">
    <h2 class="lock-title">Acesso Admin</h2>
    <p class="lock-sub">
      Área reservada para gestão e acesso aos módulos completos.
    </p>
    <div class="lock-row">
      <input id="pw" type="password" placeholder="Password admin" autocomplete="current-password" />
      <button id="btn">Entrar</button>
    </div>
    <div id="err" class="lock-err">Password inválida.</div>
    <div class="lock-mini">
      <span>Garvetur Porto Pro</span>
      <a class="mini-link" href="./index.html">Voltar ao portal</a>
    </div>
  </div>
</div>

<header>
  <div class="brand">
    <div class="brand-icon">
      <svg width="18" height="18" viewBox="0 0 24 24" stroke="var(--gold)" fill="none" stroke-width="1.8">
        <circle cx="12" cy="12" r="9"></circle>
        <path d="M8 12.5l2.5 2.5L16 9"></path>
      </svg>
    </div>
    <div>
      <h1>Garvetur Porto Pro</h1>
      <span class="sub">Admin cockpit — acesso total</span>
    </div>
  </div>
  <span class="badge">Privado</span>
</header>

<main>
  <section class="hero">
    <div>
      <h2>Cockpit Admin</h2>
      <p>
        A partir daqui mantém o acesso completo aos módulos originais (edição/gestão).
        O portal público (index) mantém-se limpo e a equipa entra apenas pelos <strong>equipa-*.html</strong>.
      </p>
    </div>
    <div class="hint">Sugestão: guarde este link nos seus favoritos.</div>
  </section>

  <section class="grid">
    <article class="card">
      <div class="card-header"><h3 class="card-title">Mapa</h3><span class="card-badge">Produto</span></div>
      <div class="card-body">Mapa completo (admin), com todas as opções e integrações.</div>
      <div class="card-footer"><a class="btn-xs primary" href="./mapa.html">Abrir</a><span class="hint">Admin</span></div>
    </article>

    <article class="card">
      <div class="card-header"><h3 class="card-title">Leads</h3><span class="card-badge">Pipeline</span></div>
      <div class="card-body">Kanban completo e formulários (edição/gestão).</div>
      <div class="card-footer"><a class="btn-xs primary" href="./kanban.html">Abrir</a><span class="hint">Admin</span></div>
    </article>

    <article class="card">
      <div class="card-header"><h3 class="card-title">Angariações</h3><span class="card-badge">Produto</span></div>
      <div class="card-body">Fichas, PDFs, anexos e base de dados local.</div>
      <div class="card-footer"><a class="btn-xs primary" href="./angariacoes.html">Abrir</a><span class="hint">Admin</span></div>
    </article>

    <article class="card">
      <div class="card-header"><h3 class="card-title">FSBO</h3><span class="card-badge">Prospecção</span></div>
      <div class="card-body">Gestão de particulares (pipeline e métricas).</div>
      <div class="card-footer"><a class="btn-xs primary" href="./particulares.html">Abrir</a><span class="hint">Admin</span></div>
    </article>

    <article class="card">
      <div class="card-header"><h3 class="card-title">Prospecção</h3><span class="card-badge">Prospecção</span></div>
      <div class="card-body">Registo e controlo de contactos por imóvel (bloqueado/livre) + histórico. Admin com gestão.</div>
      <div class="card-footer">
        <a class="btn-xs primary" href="./prospeccao.html?admin=1">Abrir</a>
        <span class="hint">Admin</span>
      </div>
    </article>

    <article class="card">
      <div class="card-header">
        <h3 class="card-title">Relatório Cliente</h3>
        <span class="card-badge">Relatórios</span>
      </div>
      <div class="card-body">
        Importa estudos de mercado (PDF) e gera uma versão estruturada e personalizada para cliente/investidor.
      </div>
      <div class="card-footer">
        <a class="btn-xs primary" href="./relatorio-cliente.html">Abrir</a>
        <span class="hint">Admin</span>
      </div>
    </article>

    <article class="card">
      <div class="card-header"><h3 class="card-title">Dashboard</h3><span class="card-badge">Análise</span></div>
      <div class="card-body">KPIs e indicadores cruzados.</div>
      <div class="card-footer"><a class="btn-xs primary" href="./dashboard.html">Abrir</a><span class="hint">Admin</span></div>
    </article>

    <article class="card">
      <div class="card-header"><h3 class="card-title">Visitas</h3><span class="card-badge">Agenda</span></div>
      <div class="card-body">Calendário de visitas (equipa completa), com criação/edição e pesquisa.</div>
      <div class="card-footer"><a class="btn-xs primary" href="./visitas.html">Abrir</a><span class="hint">Admin</span></div>
    </article>

    <article class="card">
      <div class="card-header">
        <h3 class="card-title">Relatório Semanal</h3>
        <span class="card-badge">Direção</span>
      </div>

      <div class="card-body">
        KPIs automáticos (Leads, Angariações, CPCV, Escrituras) + observações por semana + comentário do Diretor/Coordenador.
      </div>

      <div class="card-footer">
        <a class="btn-xs primary" href="./relatorio-semanal.html">Abrir</a>
        <span class="hint">Uso pessoal / gestão</span>
      </div>
    </article>

    <article class="card">
      <div class="card-header">
        <h3 class="card-title">Executivo · KPIs</h3>
        <span class="card-badge">Direção</span>
      </div>
      <div class="card-body">
        Visão executiva consolidada com KPIs de vendas, volume e comissões.
        Sem detalhe operacional ou dados sensíveis.
      </div>
      <div class="card-footer">
        <a class="btn-xs primary" href="./executivo-kpis.html">Abrir</a>
        <span class="hint">Uso pessoal / gestão</span>
      </div>
    </article>

    <article class="card">
      <div class="card-header"><h3 class="card-title">Vendas</h3><span class="card-badge">Fechos</span></div>
      <div class="card-body">Versão completa (admin) com ligações aos módulos de origem.</div>
      <div class="card-footer"><a class="btn-xs primary" href="./vendas.html">Abrir</a><span class="hint">Admin</span></div>
    </article>

    <article class="card">
      <div class="card-header"><h3 class="card-title">Tarefas</h3><span class="card-badge">Operação</span></div>
      <div class="card-body">Gestão de follow-up e ligações internas.</div>
      <div class="card-footer"><a class="btn-xs primary" href="./tarefas.html">Abrir</a><span class="hint">Admin</span></div>
    </article>

    <article class="card">
      <div class="card-header"><h3 class="card-title">Perfil do Utilizador</h3><span class="card-badge">Identidade</span></div>
      <div class="card-body">Dados do consultor (nome, empresa, cargo) para consumo por placeholders nos módulos.</div>
      <div class="card-footer"><a class="btn-xs primary" href="./perfil.html">Abrir</a><span class="hint">Admin</span></div>
    </article>

    <article class="card">
      <div class="card-header"><h3 class="card-title">Consultores</h3><span class="card-badge">Admin</span></div>
      <div class="card-body">Gestão central da equipa (impacta filtros em todos os módulos).</div>
      <div class="card-footer"><a class="btn-xs primary" href="./consultores-admin.html">Abrir</a><span class="hint">Admin</span></div>
    </article>

    <article class="card">
      <div class="card-header"><h3 class="card-title">Portal (Equipa)</h3><span class="card-badge">Acesso</span></div>
      <div class="card-body">Voltar ao index limpo (sem links para módulos completos).</div>
      <div class="card-footer"><a class="btn-xs" href="./index.html">Abrir</a><span class="hint">Portal</span></div>
    </article>
  </section>

  <!-- === NOVO: Gestão de Licença (Local) — apenas Admin === -->
  <section style="margin-top:14px;">
    <article class="card" id="licCard">
      <div class="card-header">
        <h3 class="card-title">Licença (Local)</h3>
        <span class="card-badge">Interno</span>
      </div>

      <div class="card-body">
        Ferramenta interna para gestão da licença nesta máquina (reset seguro).
        <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <span class="pill" id="licStatusPill">Estado: —</span>
          <span class="pill" id="devStatusPill">Device ID: —</span>
        </div>

        <div style="margin-top:10px;" class="kv">
          <div class="k">license_key</div><div class="v" id="kvLicense">—</div>
          <div class="k">device_id</div><div class="v" id="kvDevice">—</div>
          <div class="k">nota</div>
          <div class="v" style="color:rgba(255,255,255,.7);">
            Reset remove apenas as chaves de licença. Os dados da app mantêm-se intactos.
          </div>
        </div>
      </div>

      <div class="card-footer">
        <div class="lic-actions">
          <div class="lic-actions-left">
            <button class="btn-xs ghost" type="button" id="licRefreshBtn">Atualizar estado</button>
            <button class="btn-xs" type="button" id="copyDeviceBtn">Copiar Device ID</button>
            <button class="btn-xs danger" type="button" id="resetLicenseBtn">Reset licença (local)</button>
          </div>
          <div class="lic-note">
            Use apenas quando precisar de “libertar” esta máquina para nova ativação.
          </div>
        </div>
      </div>
    </article>
  </section>
</main>

<script>
(function(){
  const PASS = '#AdminGarvetur#1997';
  const KEY  = 'gpp_admin_auth_v1';

  const lock = document.getElementById('lock');
  const pw   = document.getElementById('pw');
  const btn  = document.getElementById('btn');
  const err  = document.getElementById('err');

  function ok(){
    try{ sessionStorage.setItem(KEY,'1'); }catch(e){}
    lock.style.display = 'none';
  }
  function fail(){
    err.style.display = 'block';
    if(pw) pw.value = '';
    pw && pw.focus();
  }
  function check(){
    try{
      if(sessionStorage.getItem(KEY)==='1'){ lock.style.display='none'; return; }
    }catch(e){}
  }
  function submit(){
    err.style.display = 'none';
    const v = (pw.value || '').trim();
    if(v === PASS) ok();
    else fail();
  }

  check();
  btn.addEventListener('click', submit);
  pw.addEventListener('keydown', (e)=>{ if(e.key==='Enter') submit(); });
  pw.focus();
})();
</script>

<script>
(function(){
  // === Gestão Local de Licença (Admin) ===
  const LICENSE_KEY_STORAGE = 'gpp_license_key_v1';
  const DEVICE_ID_STORAGE   = 'gpp_device_id_v1';

  const licStatusPill = document.getElementById('licStatusPill');
  const devStatusPill = document.getElementById('devStatusPill');
  const kvLicense = document.getElementById('kvLicense');
  const kvDevice  = document.getElementById('kvDevice');

  const refreshBtn = document.getElementById('licRefreshBtn');
  const resetBtn   = document.getElementById('resetLicenseBtn');
  const copyBtn    = document.getElementById('copyDeviceBtn');

  function setPill(el, text, mode){
    el.textContent = text;
    el.classList.remove('ok','warn','bad');
    if(mode) el.classList.add(mode);
  }

  function getLS(key){
    try{ return localStorage.getItem(key); }catch(e){ return null; }
  }
  function delLS(key){
    try{ localStorage.removeItem(key); }catch(e){}
  }

  function refresh(){
    const lic = (getLS(LICENSE_KEY_STORAGE) || '').trim();
    const dev = (getLS(DEVICE_ID_STORAGE) || '').trim();

    kvLicense.textContent = lic || '—';
    kvDevice.textContent  = dev || '—';

    if(lic){
      setPill(licStatusPill, 'Licença: definida', 'ok');
    }else{
      setPill(licStatusPill, 'Licença: ausente', 'warn');
    }

    if(dev){
      setPill(devStatusPill, 'Device ID: definido', 'ok');
    }else{
      setPill(devStatusPill, 'Device ID: ausente', 'warn');
    }
  }

  async function copyDevice(){
    const dev = (getLS(DEVICE_ID_STORAGE) || '').trim();
    if(!dev){
      alert('Não existe Device ID local para copiar.');
      return;
    }
    try{
      await navigator.clipboard.writeText(dev);
      alert('Device ID copiado para a área de transferência.');
    }catch(e){
      // fallback simples
      prompt('Copie o Device ID:', dev);
    }
  }

  function resetLicense(){
    const lic = (getLS(LICENSE_KEY_STORAGE) || '').trim();
    const dev = (getLS(DEVICE_ID_STORAGE) || '').trim();

    const msg =
      'Confirma o reset local da licença nesta máquina?\n\n' +
      'Será removido APENAS:\n' +
      '• ' + LICENSE_KEY_STORAGE + (lic ? ' ('+lic+')' : '') + '\n' +
      '• ' + DEVICE_ID_STORAGE   + (dev ? ' ('+dev+')' : '') + '\n\n' +
      'Os dados da app NÃO são apagados.';

    if(!confirm(msg)) return;

    delLS(LICENSE_KEY_STORAGE);
    delLS(DEVICE_ID_STORAGE);

    refresh();

    alert('Reset concluído. Ao abrir o index, será pedida nova chave e será gerado um novo Device ID.');
  }

  refreshBtn && refreshBtn.addEventListener('click', refresh);
  resetBtn && resetBtn.addEventListener('click', resetLicense);
  copyBtn && copyBtn.addEventListener('click', copyDevice);

  // arranque
  refresh();
})();
</script>

</body>
</html>
