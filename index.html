<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <title>Garvetur Porto Pro — Central</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --gold:#A38B63;
      --gold-soft:rgba(163,139,99,.35);
      --bg:#0B0B0B;
      --panel:#121212;
      --panel-soft:#181818;
      --text:#FFFFFF;
      --muted:#A0A0A0;
      --danger:#F25F5C;
      --success:#4CAF50;
      --warning:#FFC857;
      --radius-lg:18px;
      --radius-md:12px;
      --shadow-soft:0 18px 35px rgba(0,0,0,.6);
    }

    *{box-sizing:border-box;}
    html,body{
      margin:0;
      height:100%;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:radial-gradient(circle at top,#1c1c1c 0,#050505 55%,#000 100%);
      color:var(--text);
    }

    body{
      display:flex;
      flex-direction:column;
    }

    .app-shell{
      display:grid;
      grid-template-rows:70px auto 32px;
      min-height:100vh;
    }

    header.app-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 20px;
      border-bottom:1px solid rgba(163,139,99,.35);
      background:linear-gradient(90deg,#050505,#111,#050505);
      position:sticky;
      top:0;
      z-index:10;
      gap:18px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .brand-icon{
      width:32px;
      height:32px;
      border-radius:999px;
      border:1px solid var(--gold);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 0 0 1px rgba(163,139,99,.3);
    }
    .brand h1{
      margin:0;
      font-size:18px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:var(--gold);
    }
    .brand span.sub{
      display:block;
      font-size:11px;
      color:var(--muted);
      letter-spacing:.16em;
      text-transform:uppercase;
    }

    .header-actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill-env{
      font-size:11px;
      padding:4px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.45);
      color:var(--muted);
      letter-spacing:.14em;
      text-transform:uppercase;
    }

    .btn{
      border-radius:999px;
      border:1px solid var(--gold-soft);
      background:rgba(12,12,12,.9);
      color:var(--text);
      padding:7px 12px;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      transition:.18s border-color,.18s background,.18s transform;
      text-decoration:none;
    }
    .btn-primary{
      background:var(--gold);
      color:#0A0A0A;
      border-color:var(--gold);
      font-weight:500;
    }
    .btn:hover{
      border-color:var(--gold);
      transform:translateY(-1px);
    }

    /* MAIN */
    main{
      padding:18px 20px 20px;
    }

    .intro-row{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:16px;
      margin-bottom:18px;
      flex-wrap:wrap;
    }
    .intro-text h2{
      margin:0 0 4px;
      font-size:16px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .intro-text p{
      margin:0;
      font-size:13px;
      color:var(--muted);
    }
    .intro-kpis{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:flex-end;
    }
    .kpi-pill{
      border-radius:999px;
      border:1px solid rgba(163,139,99,.5);
      padding:4px 10px;
      font-size:11px;
      color:var(--muted);
      background:rgba(0,0,0,.6);
    }
    .kpi-pill span.value{
      color:var(--gold);
      font-weight:600;
      margin-left:4px;
    }

    /* GRID DE MÓDULOS */
    .modules-grid{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:14px;
    }
    @media (max-width:1100px){
      .modules-grid{grid-template-columns:repeat(2,minmax(0,1fr));}
    }
    @media (max-width:720px){
      .app-shell{grid-template-rows:auto auto 32px;}
      .modules-grid{grid-template-columns:1fr;}
    }

    .module-card{
      border-radius:var(--radius-lg);
      border:1px solid rgba(163,139,99,.3);
      background:radial-gradient(circle at top left,#191919,#050505);
      box-shadow:var(--shadow-soft);
      padding:12px 12px 11px;
      display:flex;
      flex-direction:column;
      gap:6px;
      position:relative;
      overflow:hidden;
    }
    .module-card::before{
      content:"";
      position:absolute;
      inset:-40%;
      opacity:0;
      background:radial-gradient(circle at top,var(--gold-soft),transparent 55%);
      transition:.26s opacity;
      pointer-events:none;
    }
    .module-card:hover::before{
      opacity:.55;
    }
    .module-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:8px;
      margin-bottom:2px;
    }
    .module-title{
      font-size:15px;
      margin:0;
      color:#fff;
    }
    .module-sub{
      font-size:11px;
      color:var(--muted);
      margin:2px 0 0;
    }
    .module-chip{
      font-size:10px;
      border-radius:999px;
      padding:3px 8px;
      border:1px solid rgba(163,139,99,.6);
      text-transform:uppercase;
      letter-spacing:.12em;
      color:var(--gold);
      background:rgba(0,0,0,.7);
      white-space:nowrap;
    }
    .module-body{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }
    .module-body p{
      margin:0 0 4px;
    }

    .module-stats{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:4px;
    }
    .stat-pill{
      font-size:11px;
      border-radius:999px;
      padding:2px 7px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(5,5,5,.85);
      color:var(--muted);
    }
    .stat-pill strong{color:var(--gold);}
    .stat-pill.danger strong{color:var(--danger);}
    .stat-pill.success strong{color:var(--success);}

    .module-footer{
      margin-top:8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .module-footer-left{
      font-size:11px;
      color:var(--muted);
    }
    .module-footer-right{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }

    .btn-xs{
      border-radius:999px;
      border:1px solid rgba(163,139,99,.5);
      background:rgba(0,0,0,.8);
      color:var(--muted);
      padding:3px 8px;
      font-size:11px;
      display:inline-flex;
      align-items:center;
      gap:5px;
      text-decoration:none;
      cursor:pointer;
    }
    .btn-xs.primary{
      border-color:var(--gold);
      color:var(--gold);
    }
    .btn-xs.disabled{
      opacity:.45;
      cursor:not-allowed;
    }

    footer{
      padding:6px 14px;
      font-size:11px;
      color:var(--muted);
      border-top:1px solid rgba(163,139,99,.28);
      background:#050505;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header class="app-header">
    <div class="brand">
      <div class="brand-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" stroke="var(--gold)" fill="none" stroke-width="1.8">
          <circle cx="12" cy="12" r="9"></circle>
          <path d="M8 12.5l2.5 2.5L16 9"></path>
        </svg>
      </div>
      <div>
        <h1>Garvetur Porto Pro</h1>
        <span class="sub">Central de operação · Garvetur Luxury Porto</span>
      </div>
    </div>
    <div class="header-actions">
      <div class="pill-env">Painel Geral</div>
      <a class="btn btn-primary" href="./mapa.html">➜ Entrar diretamente no Mapa</a>
    </div>
  </header>

  <main>
    <div class="intro-row">
      <div class="intro-text">
        <h2>Visão geral</h2>
        <p>Selecione o módulo para entrar em detalhe. Os dados de Leads e Angariações são lidos deste navegador.</p>
      </div>
      <div class="intro-kpis">
        <div class="kpi-pill">Leads ativas <span class="value" id="kpiLeadsAtivas">–</span></div>
        <div class="kpi-pill">Leads invisíveis <span class="value" id="kpiLeadsHidden">–</span></div>
        <div class="kpi-pill">Angariações visíveis <span class="value" id="kpiAngVisiveis">–</span></div>
        <div class="kpi-pill">Angariações invisíveis <span class="value" id="kpiAngHidden">–</span></div>
      </div>
    </div>

    <section class="modules-grid">

      <!-- MAPA -->
      <article class="module-card">
        <div class="module-header">
          <div>
            <h3 class="module-title">Mapa</h3>
            <p class="module-sub">Empreendimentos e produto georreferenciado na AMP / Porto.</p>
          </div>
          <span class="module-chip">Mapa</span>
        </div>
        <div class="module-body">
          <p>Visualização geográfica dos empreendimentos, pins por estado (em construção, pronto, etc.) e painel lateral com detalhes e documentos.</p>
          <div class="module-stats">
            <span class="stat-pill"><strong>CSV local</strong> · empreendimentos.csv</span>
            <span class="stat-pill">Gestão direta na app</span>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-footer-left">Sugestão: usar em reuniões com clientes e promotores.</div>
          <div class="module-footer-right">
            <a class="btn-xs primary" href="./mapa.html">Abrir Mapa</a>
          </div>
        </div>
      </article>

      <!-- LEADS -->
      <article class="module-card">
        <div class="module-header">
          <div>
            <h3 class="module-title">Leads</h3>
            <p class="module-sub">Pipeline comercial em Kanban com fecho detalhado.</p>
          </div>
          <span class="module-chip">Leads</span>
        </div>
        <div class="module-body">
          <p>Gestão completa de Leads por consultor: qualificação, visitas, propostas, fechos, comissão e valores intercalares.</p>
          <div class="module-stats">
            <span class="stat-pill"><strong>Total:</strong> <span id="statLeadsTotal">–</span></span>
            <span class="stat-pill success"><strong>Ativas:</strong> <span id="statLeadsActive">–</span></span>
            <span class="stat-pill"><strong>Invisíveis:</strong> <span id="statLeadsHidden">–</span></span>
            <span class="stat-pill"><strong>Fechos:</strong> <span id="statLeadsFecho">–</span></span>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-footer-left">Leitura feita do armazenamento local deste navegador.</div>
          <div class="module-footer-right">
            <a class="btn-xs primary" href="./kanban.html">Abrir Leads</a>
          </div>
        </div>
      </article>

      <!-- ANGARIAÇÕES -->
      <article class="module-card">
        <div class="module-header">
          <div>
            <h3 class="module-title">Angariações</h3>
            <p class="module-sub">Ficha de produto completa com PDF institucional.</p>
          </div>
          <span class="module-chip">Produto</span>
        </div>
        <div class="module-body">
          <p>Gestão avançada de angariações: proprietário, empreendimento, áreas, preço, comissão, ajustamento e características (10.1–10.5).</p>
          <div class="module-stats">
            <span class="stat-pill"><strong>Total:</strong> <span id="statAngTotal">–</span></span>
            <span class="stat-pill success"><strong>Visíveis:</strong> <span id="statAngVisiveis">–</span></span>
            <span class="stat-pill"><strong>Invisíveis:</strong> <span id="statAngHidden">–</span></span>
            <span class="stat-pill"><strong>Aprovadas:</strong> <span id="statAngAprovadas">–</span></span>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-footer-left">Exportação CSV e PDF formatado Garvetur Luxury Porto.</div>
          <div class="module-footer-right">
            <a class="btn-xs primary" href="./angariacoes.html">Abrir Angariações</a>
          </div>
        </div>
      </article>

      <!-- DASHBOARD -->
      <article class="module-card">
        <div class="module-header">
          <div>
            <h3 class="module-title">Dashboard</h3>
            <p class="module-sub">KPIs globais de Leads e Angariações.</p>
          </div>
          <span class="module-chip">Análise</span>
        </div>
        <div class="module-body">
          <p>Visão consolidada das métricas principais: nº de leads, angariações, exclusividades, taxa de fecho e distribuição por consultor.</p>
          <div class="module-stats">
            <span class="stat-pill"><strong>Fonte:</strong> Leads + Angariações</span>
            <span class="stat-pill">Atualiza em tempo real neste navegador</span>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-footer-left">Use para reportings rápidos e reuniões internas.</div>
          <div class="module-footer-right">
            <a class="btn-xs primary" href="./dashboard.html">Abrir Dashboard</a>
          </div>
        </div>
      </article>

      <!-- VENDAS (futuro) -->
      <article class="module-card">
        <div class="module-header">
          <div>
            <h3 class="module-title">Vendas</h3>
            <p class="module-sub">(Futuro) Consolidação de negócios fechados.</p>
          </div>
          <span class="module-chip">Em planeamento</span>
        </div>
        <div class="module-body">
          <p>Pensado para consolidar todas as transações fechadas (a partir de Fechos nas Leads e Angariações), com métricas por consultor e por origem.</p>
          <div class="module-stats">
            <span class="stat-pill danger"><strong>Estado:</strong> Em desenho</span>
            <span class="stat-pill">Link já preparado: vendas.html</span>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-footer-left">Quando criarmos o módulo, o link já estará pronto.</div>
          <div class="module-footer-right">
            <a class="btn-xs disabled" href="./vendas.html" onclick="return false;">Indisponível</a>
          </div>
        </div>
      </article>

      <!-- TAREFAS (futuro) -->
      <article class="module-card">
        <div class="module-header">
          <div>
            <h3 class="module-title">Tarefas</h3>
            <p class="module-sub">(Futuro) Follow-up diário por consultor.</p>
          </div>
          <span class="module-chip">Em planeamento</span>
        </div>
        <div class="module-body">
          <p>Planeado como agenda operacional: follow-ups de leads, prazos de angariações, tarefas por consultor e prioridades diárias.</p>
          <div class="module-stats">
            <span class="stat-pill danger"><strong>Estado:</strong> Em desenho</span>
            <span class="stat-pill">Link já preparado: tarefas.html</span>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-footer-left">Ideal para a próxima fase da app.</div>
          <div class="module-footer-right">
            <a class="btn-xs disabled" href="./tarefas.html" onclick="return false;">Indisponível</a>
          </div>
        </div>
      </article>

    </section>
  </main>

  <footer>
    <span>Garvetur Porto Pro · Dados guardados no navegador (localStorage).</span>
    <span>Leads: chave <code>gpp_leads_v5</code> | Angariações: <code>gpp_angariacoes_v2</code></span>
  </footer>
</div>

<script>
(function(){
  // Lê Leads (array) de gpp_leads_v5
  function loadLeads(){
    try{
      const raw = localStorage.getItem('gpp_leads_v5');
      if(!raw) return [];
      const parsed = JSON.parse(raw);
      return Array.isArray(parsed) ? parsed : [];
    }catch(e){
      console.error('Erro a ler leads', e);
      return [];
    }
  }

  // Lê Angariações (objeto {locked, deals:[]}) de gpp_angariacoes_v2
  function loadAngariacoes(){
    try{
      const raw = localStorage.getItem('gpp_angariacoes_v2');
      if(!raw) return [];
      const parsed = JSON.parse(raw);
      if(parsed && Array.isArray(parsed.deals)) return parsed.deals;
      return [];
    }catch(e){
      console.error('Erro a ler angariações', e);
      return [];
    }
  }

  function updateLeadsStats(){
    const leads = loadLeads();
    const total = leads.length;
    const ativas = leads.filter(l=>l.visivel !== false).length;
    const invisiveis = leads.filter(l=>l.visivel === false).length;
    const fecho = leads.filter(l=>l.estado === 'Fecho').length;

    const set = (id,val)=>{ var el=document.getElementById(id); if(el) el.textContent = String(val); };

    set('kpiLeadsAtivas', ativas);
    set('kpiLeadsHidden', invisiveis);

    set('statLeadsTotal', total);
    set('statLeadsActive', ativas);
    set('statLeadsHidden', invisiveis);
    set('statLeadsFecho', fecho);
  }

  function updateAngStats(){
    const deals = loadAngariacoes();
    const total = deals.length;
    const visiveis = deals.filter(d=>d.visible !== false).length;
    const invisiveis = deals.filter(d=>d.visible === false).length;
    const aprovadas = deals.filter(d=>d.estadoAng === 'aprovado').length;

    const set = (id,val)=>{ var el=document.getElementById(id); if(el) el.textContent = String(val); };

    set('kpiAngVisiveis', visiveis);
    set('kpiAngHidden', invisiveis);

    set('statAngTotal', total);
    set('statAngVisiveis', visiveis);
    set('statAngHidden', invisiveis);
    set('statAngAprovadas', aprovadas);
  }

  // Atualizar ao carregar a página
  updateLeadsStats();
  updateAngStats();

  // Opcional: atualizar ao regressar ao separador (caso tenha alterado noutro módulo)
  document.addEventListener('visibilitychange', function(){
    if(!document.hidden){
      updateLeadsStats();
      updateAngStats();
    }
  });
})();
</script>
</body>
</html>
