<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Garvetur Porto Pro — Angariações</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
  :root{--gold:#A38B63;--bg:#0E0E0E;--panel:#131313;--text:#fff;--muted:#bdbdbd;}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;}
  header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.1);background:#0F0F0F;}
  nav a{margin-right:6px;text-decoration:none;color:#ddd;border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:8px;}
  nav a.active{background:var(--gold);color:#111;border-color:var(--gold);font-weight:600;}
  .actions{display:flex;gap:8px;}
  .btn{background:transparent;border:1px solid rgba(163,139,99,.5);color:#fff;padding:6px 9px;border-radius:8px;cursor:pointer;font-size:12px;}
  .wrap{display:grid;grid-template-columns:380px 1fr;gap:12px;padding:12px;}
  .panel{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px;}
  .panel h3{margin:0 0 8px 0;font-size:13px;color:#eaeaea;border-bottom:1px solid rgba(255,255,255,.06);padding-bottom:6px;}
  label{font-size:12px;color:#ddd;display:block;margin:7px 0 2px;}
  input,select,textarea{width:100%;background:#0E0E0E;color:#fff;border:1px solid rgba(255,255,255,.18);border-radius:8px;padding:8px 10px;}
  .list{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
  .card{background:#0E0E0E;border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:8px;}
  .t{font-weight:600;margin-bottom:4px;}
  .m{font-size:12px;color:#cfcfcf;}
  .chk{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px;}
  .chk label{display:flex;gap:6px;align-items:center;background:#0E0E0E;border:1px solid rgba(255,255,255,.18);padding:6px 8px;border-radius:8px;}
  .semaforo{display:inline-block;width:10px;height:10px;border-radius:50%;margin-left:8px;background:#888;}
  @media(max-width:1000px){.wrap{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:10px;">
    <strong style="color:#FFD166">Garvetur Porto Pro</strong>
    <nav>
      <a href="./index.html">Mapa</a>
      <a href="./kanban.html">Leads</a>
      <a class="active" href="./angariacoes.html">Angariações</a>
      <a href="./dashboard.html">Dashboard</a>
    </nav>
  </div>
  <div class="actions">
    <button id="seed" class="btn">Carregar dados de exemplo (5)</button>
    <button id="clear" class="btn">Limpar tudo</button>
  </div>
</header>

<div class="wrap">
  <div class="panel">
    <h3>Nova Angariação</h3>
    <label>Propriedade</label><input id="p" placeholder="Ex.: T3 Boavista | Porto">
    <label>Consultor</label><input id="c" placeholder="Ex.: Manuel">
    <label>Origem</label><input id="o" placeholder="Ex.: Referral / Porta-a-porta / Online">
    <label>Preço pedido (€)</label><input id="pp" type="number" step="0.01" placeholder="Ex.: 650000">
    <label>Preço sugerido (€)</label><input id="ps" type="number" step="0.01" placeholder="Ex.: 620000">
    <div style="margin-top:8px;font-size:12px;">% Ajustamento: <span id="aj">—</span> <span class="semaforo" id="sf"></span></div>
    <div class="chk">
      <label><input type="checkbox" id="doc_cc"> CC</label>
      <label><input type="checkbox" id="doc_caderneta"> Caderneta</label>
      <label><input type="checkbox" id="doc_cert_ener"> Cert. Energético</label>
      <label><input type="checkbox" id="doc_planta"> Planta</label>
      <label><input type="checkbox" id="doc_cpcv"> Minuta CPCV</label>
    </div>
    <label>Notas</label><textarea id="n" rows="3" placeholder="Observações relevantes"></textarea>
    <div style="margin-top:8px;display:flex;gap:8px;">
      <button class="btn" id="add">Guardar angariação</button>
    </div>
  </div>

  <div class="panel">
    <h3>Lista</h3>
    <div class="list" id="list"></div>
  </div>
</div>

<script>
const LS_KEY = 'gpp_ang_v1';

function load(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)||'[]'); }catch(e){ return []; } }
function save(d){ localStorage.setItem(LS_KEY, JSON.stringify(d)); }
function pct(pp,ps){ if(!pp||!ps) return null; const v=(ps-pp)/pp*100; return Math.round(v*10)/10; }
function semaforo(el, val){
  let c='#888';
  if(val!=null){
    if(val>=-3 && val<=3) c='#22c55e';       // verde (ajuste controlado)
    else if(val>-7) c='#f59e0b';             // âmbar
    else c='#ef4444';                        // vermelho
  }
  el.style.background=c;
}

function cardEl(a, idx){
  const d = document.createElement('div');
  d.className='card';
  d.innerHTML = `<div class="t">${a.prop}</div>
                 <div class="m">${a.consultor || ''} · ${a.origem || ''}</div>
                 <div class="m">Pedido: ${a.pp||'-'}€ · Sugerido: ${a.ps||'-'}€ · Ajuste: ${a.aj!=null?a.aj+'%':'—'}</div>
                 <div class="m">Docs: ${a.docs?.join(', ')||'—'}</div>
                 ${a.notas? `<div class="m"><em>${a.notas}</em></div>`:''}
                 <div style="margin-top:6px;display:flex;gap:6px;">
                   <button class="btn" data-a="edit">Editar</button>
                   <button class="btn" data-a="del">Remover</button>
                 </div>`;
  d.querySelector('[data-a="edit"]').onclick=()=> edit(idx);
  d.querySelector('[data-a="del"]').onclick=()=> del(idx);
  return d;
}

function render(){
  const data = load();
  const list = document.getElementById('list');
  list.innerHTML='';
  data.forEach((a,i)=> list.appendChild(cardEl(a,i)));
}

function add(){
  const prop = document.getElementById('p').value.trim();
  if(!prop) return alert('Indique a propriedade.');
  const consultor = document.getElementById('c').value.trim();
  const origem = document.getElementById('o').value.trim();
  const pp = Number(document.getElementById('pp').value) || null;
  const ps = Number(document.getElementById('ps').value) || null;
  const aj = pct(pp, ps);
  const docs = [];
  if(document.getElementById('doc_cc').checked) docs.push('CC');
  if(document.getElementById('doc_caderneta').checked) docs.push('Caderneta');
  if(document.getElementById('doc_cert_ener').checked) docs.push('Cert. Energético');
  if(document.getElementById('doc_planta').checked) docs.push('Planta');
  if(document.getElementById('doc_cpcv').checked) docs.push('Minuta CPCV');
  const notas = document.getElementById('n').value.trim();

  const data = load();
  data.unshift({prop, consultor, origem, pp, ps, aj, docs, notas});
  save(data); render(); clearForm();
}

function clearForm(){
  ['p','c','o','pp','ps','n'].forEach(id=> document.getElementById(id).value='');
  ['doc_cc','doc_caderneta','doc_cert_ener','doc_planta','doc_cpcv'].forEach(id=> document.getElementById(id).checked=false);
  document.getElementById('aj').textContent='—'; semaforo(document.getElementById('sf'), null);
}

function edit(idx){
  const data = load(); const a = data[idx];
  const prop = prompt('Propriedade:', a.prop)||a.prop;
  const consultor = prompt('Consultor:', a.consultor||'')??a.consultor;
  const origem = prompt('Origem:', a.origem||'')??a.origem;
  const pp = Number(prompt('Preço pedido (€):', a.pp ?? '')) || null;
  const ps = Number(prompt('Preço sugerido (€):', a.ps ?? '')) || null;
  const aj = pct(pp, ps);
  const notas = prompt('Notas:', a.notas||'')??a.notas;
  data[idx] = {prop, consultor, origem, pp, ps, aj, docs:a.docs||[], notas};
  save(data); render();
}

function del(idx){
  if(!confirm('Remover esta angariação?')) return;
  const data = load();
  data.splice(idx,1);
  save(data); render();
}

// Atualizar % ajustamento e semáforo em tempo real
['pp','ps'].forEach(id=>{
  document.getElementById(id).addEventListener('input', ()=>{
    const pp = Number(document.getElementById('pp').value)||null;
    const ps = Number(document.getElementById('ps').value)||null;
    const val = pct(pp, ps);
    document.getElementById('aj').textContent = (val!=null ? val+'%' : '—');
    semaforo(document.getElementById('sf'), val);
  });
});

// Seed demo (5)
function seedDemo(){
  if(!confirm('Carregar 5 angariações de exemplo? (substitui as atuais)')) return;
  const ex = [
    {prop:"T3 Boavista | Porto", consultor:"Manuel", origem:"Referral", pp:650000, ps:620000, aj:-4.6, docs:["CC","Caderneta","Cert. Energético"], notas:"Avaliação agendada"},
    {prop:"T2 Madalena | V.N. Gaia", consultor:"Armanda", origem:"Porta-a-porta", pp:320000, ps:315000, aj:-1.6, docs:["CC","Caderneta"], notas:"Vendedor disponível negociar"},
    {prop:"Loja Foz | Porto", consultor:"João", origem:"Online", pp:480000, ps:450000, aj:-6.3, docs:["CC","Caderneta","Planta"], notas:"Objetivo yield 6%"},
    {prop:"Terreno Gondomar", consultor:"Manuel", origem:"Investidor", pp:900000, ps:870000, aj:-3.3, docs:["CC"], notas:"Pedido minuta CPCV"},
    {prop:"Prédio Baixa | Porto", consultor:"Audrey", origem:"Gestor de ativos", pp:2200000, ps:2100000, aj:-4.5, docs:["CC","Caderneta","Cert. Energético","Planta","Minuta CPCV"], notas:"Visita técnica 5ª feira"}
  ];
  save(ex); render();
}

document.getElementById('add').onclick=add;
document.getElementById('seed').onclick=seedDemo;
document.getElementById('clear').onclick=()=>{ if(confirm('Apagar todas as angariações?')){ localStorage.removeItem(LS_KEY); render(); } };
render();
</script>
</body>
</html>
