<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Garvetur Porto Pro — Mapa (PDF inteligente)</title>

<link rel="preconnect" href="https://unpkg.com" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

<!-- Leaflet + Cluster CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" crossorigin="anonymous">

<!-- PapaParse (CSV) -->
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js" crossorigin="anonymous" defer></script>

<!-- idb-keyval (IndexedDB) -->
<script src="https://cdn.jsdelivr.net/npm/idb-keyval@6/dist/idb-keyval.iife.min.js" crossorigin="anonymous"></script>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" crossorigin="anonymous"></script>
<script>
  if (window['pdfjsLib']) {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  }
</script>

<style>
:root{
  --gold:#A38B63;
  --bg:#0B0B0B;
  --panel:#141414;
  --border:rgba(255,255,255,.14);
  --text:#FFFFFF;
  --muted:#A0A0A0;
}
*{box-sizing:border-box;}
html,body{
  margin:0;
  height:100%;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  background:radial-gradient(circle at top,#1c1c1c 0,#050505 55%,#000 100%);
  color:var(--text);
}
.app-shell{display:grid;grid-template-rows:64px auto;height:100%;}

/* Barra superior */
header.app-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 18px;border-bottom:1px solid rgba(163,139,99,.35);
  background:linear-gradient(90deg,#050505,#111,#050505);
  gap:16px;flex-wrap:wrap;
}
.brand{display:flex;align-items:center;gap:10px;}
.brand-icon{width:26px;height:26px;border-radius:999px;border:1px solid var(--gold);
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 0 0 1px rgba(163,139,99,.3);}
.brand h1{margin:0;font-size:17px;letter-spacing:.04em;
  text-transform:uppercase;color:var(--gold);}
.brand span.sub{display:block;font-size:11px;color:var(--muted);
  letter-spacing:.12em;text-transform:uppercase;}
.nav-tabs{
  display:flex;flex-wrap:wrap;align-items:center;gap:4px;
  background:rgba(0,0,0,.35);padding:4px;
  border-radius:999px;border:1px solid rgba(163,139,99,.35);
}
.nav-tab{padding:5px 10px;border-radius:999px;font-size:11px;
  text-decoration:none;color:var(--muted);
  letter-spacing:.12em;text-transform:uppercase;
  border:1px solid transparent;transition:.16s background,.16s color,.16s border-color,.16s transform;}
.nav-tab:hover{color:#fff;border-color:rgba(163,139,99,.6);transform:translateY(-1px);}
.nav-tab.active{background:var(--gold);color:#0A0A0A;border-color:var(--gold);font-weight:600;}

/* Área principal */
.app{display:grid;grid-template-columns:380px minmax(0,1fr);
  height:calc(100vh - 64px);max-height:calc(100vh - 64px);overflow:hidden;}
.sidebar{background:var(--panel);border-right:1px solid var(--border);overflow:auto;}
.main-map-area{display:flex;flex-direction:column;background:radial-gradient(circle at top,#1a1a1a,#050505 55%,#000 100%);}
.map-wrapper{position:relative;flex:1;min-height:260px;}
#map{width:100%;height:100%;}
.legend{position:absolute;left:12px;bottom:16px;z-index:5000;background:#111;border:1px solid var(--border);
  border-radius:10px;padding:8px 10px;font-size:12px;color:#fff;}
.legend .row{display:flex;gap:8px;align-items:center;}
.legend .swatch{width:12px;height:12px;border-radius:3px;border:1px solid rgba(0,0,0,.3);}
.legend .c{background:#E53935}
.legend .l{background:#1E88E5}
.legend .f{background:#43A047}
</style>
</head>
<body>
<div class="app-shell">
  <header class="app-header">
    <div class="brand">
      <div class="brand-icon">
        <svg width="16" height="16" viewBox="0 0 24 24" stroke="var(--gold)" fill="none" stroke-width="1.8">
          <circle cx="12" cy="12" r="9"></circle>
          <path d="M8 12.5l2.5 2.5L16 9"></path>
        </svg>
      </div>
      <div>
        <h1>Garvetur Porto Pro — Mapa</h1>
        <span class="sub">Produto em promoção & PDF inteligente</span>
      </div>
    </div>

    <nav class="nav-tabs">
      <a href="index.html" class="nav-tab">Início</a>
      <a href="mapa.html" class="nav-tab active">Mapa</a>
      <a href="kanban.html" class="nav-tab">Leads</a>
      <a href="angariacoes.html" class="nav-tab">Angariações</a>
      <a href="dashboard.html" class="nav-tab">Dashboard</a>
      <a href="vendas.html" class="nav-tab">Vendas</a>
      <a href="tarefas.html" class="nav-tab">Tarefas</a>
    </nav>
  </header>

  <div class="app">
    <aside class="sidebar">
      <div style="padding:12px">
        <div class="label">Pesquisa global</div>
        <input id="q" placeholder="Ex.: 'Gaia licenciado 2027 promotor X'" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--border);background:#0E0E0E;color:#fff">
        <div style="font-size:11px;color:#aaa;margin-top:4px">Pesquisa por nome, concelho, promotor, tipologias, estado, conclusão, notas e €/m².</div>
      </div>
    </aside>

    <div class="main-map-area">
      <div class="map-wrapper">
        <div id="map"></div>
        <div class="legend">
          <div class="row"><span class="swatch c"></span> Em construção</div>
          <div class="row"><span class="swatch l"></span> Licenciado</div>
          <div class="row"><span class="swatch f"></span> Concluído</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<script>
const MAP = L.map('map',{ zoomControl:true }).setView([41.15,-8.61], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(MAP);
const markers = L.markerClusterGroup();
const dummyData = [
  {nome:"The View I",lat:41.12,lng:-8.58,estado:"em construção"},
  {nome:"Boavista II",lat:41.16,lng:-8.64,estado:"licenciado"},
  {nome:"Oceanic Reserve",lat:41.14,lng:-8.66,estado:"concluído"}
];
dummyData.forEach(p=>{
  const color = p.estado==="em construção"?"#E53935":p.estado==="licenciado"?"#1E88E5":"#43A047";
  const icon = L.divIcon({className:"",html:`<div style='width:22px;height:22px;border-radius:50%;background:${color};border:2px solid #000'></div>`});
  const m = L.marker([p.lat,p.lng],{icon}).bindTooltip(`${p.nome} (${p.estado})`);
  markers.addLayer(m);
});
MAP.addLayer(markers);
</script>
</body>
</html>
