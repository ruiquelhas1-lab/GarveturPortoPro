<!doctype html>
<html lang="pt-PT">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Garvetur Porto Pro — Visitas (Admin)</title>

<style>
:root{
  --gold:#A38B63;
  --bg:#0B0B0B;
  --panel:#151515;
  --border:rgba(255,255,255,.14);
  --text:#fff;
  --muted:#bdbdbd;
  --radius:16px;
}

*{box-sizing:border-box}
html,body{margin:0;height:100%}
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  background:radial-gradient(circle at top,#1c1c1c 0,#050505 55%,#000 100%);
  color:var(--text);
}

header{
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 18px;
  border-bottom:1px solid rgba(163,139,99,.35);
  background:linear-gradient(90deg,#050505,#111,#050505);
}
h1{
  margin:0;
  font-size:16px;
  letter-spacing:.14em;
  text-transform:uppercase;
  color:var(--gold);
}

main{padding:18px;display:grid;grid-template-columns:360px 1fr;gap:14px}
@media(max-width:980px){main{grid-template-columns:1fr}}

.card{
  background:linear-gradient(145deg,#181818,#0C0C0C);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:14px;
  margin-bottom:14px;
}

label{font-size:12px;color:#ddd;margin-top:8px;display:block}
input,select{
  width:100%;
  margin-top:4px;
  padding:8px 10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.18);
  background:#000;
  color:#fff;
}

button{
  border-radius:999px;
  padding:8px 12px;
  border:1px solid rgba(163,139,99,.55);
  background:#000;
  color:var(--gold);
  cursor:pointer;
}
button.primary{background:var(--gold);color:#000;font-weight:700}

.row{display:flex;gap:8px;flex-wrap:wrap}

.tabs{display:flex;gap:8px;margin-bottom:12px}
.tab{
  padding:6px 12px;
  border-radius:999px;
  border:1px solid rgba(163,139,99,.4);
  cursor:pointer;
  font-size:12px;
}
.tab.active{background:var(--gold);color:#000;font-weight:700}

.kpis{display:flex;gap:12px;margin-bottom:12px;flex-wrap:wrap}
.kpi{
  border:1px solid rgba(163,139,99,.35);
  border-radius:14px;
  padding:10px 14px;
  font-size:12px;
}
.kpi b{font-size:18px;display:block;color:#fff}

.event{
  border:1px solid rgba(255,255,255,.15);
  border-radius:14px;
  padding:10px;
  margin-bottom:8px;
  background:rgba(0,0,0,.35);
  cursor:pointer;
}
.event:hover{border-color:var(--gold)}
.event b{color:#fff}

.small{font-size:11px;color:var(--muted)}
</style>
</head>

<body>

<header>
  <h1>Visitas — Admin</h1>
</header>

<main>
  <!-- FORM -->
  <aside>
    <div class="card">
      <h3>Registar Visita</h3>

      <label>Consultor</label>
      <select id="consultor">
        <option>Manuel Oliveira</option>
        <option>João Sousa</option>
        <option>Francisco Santos</option>
        <option>Rosário Costa</option>
        <option>Dalila Cunha</option>
        <option>Rui Quelhas</option>
      </select>

      <label>Data da visita</label>
      <input type="date" id="data">

      <label>Hora</label>
      <input type="time" id="hora">

      <label>Cliente</label>
      <input id="cliente">

      <label>Ref. Imóvel Garvetur</label>
      <input id="ref">

      <label>Partilha – Agência</label>
      <input id="agencia">

      <label>Link do imóvel</label>
      <input id="link">

      <div class="row" style="margin-top:12px">
        <button class="primary" id="save">Guardar</button>
        <button id="reset">Limpar</button>
      </div>
    </div>
  </aside>

  <!-- CALENDÁRIO -->
  <section>
    <div class="tabs">
      <div class="tab active" data-view="month">Mensal</div>
      <div class="tab" data-view="week">Semanal</div>
      <div class="tab" data-view="day">Diária</div>
    </div>

    <div class="row" style="margin-bottom:10px">
      <select id="filterConsultor">
        <option value="">Todos os consultores</option>
        <option>Manuel Oliveira</option>
        <option>João Sousa</option>
        <option>Francisco Santos</option>
        <option>Rosário Costa</option>
        <option>Dalila Cunha</option>
        <option>Rui Quelhas</option>
      </select>
      <input id="q" placeholder="Pesquisar…">
    </div>

    <div class="kpis" id="kpis"></div>

    <div class="card">
      <div id="calendar"></div>
    </div>
  </section>
</main>

<script>
const LS='gpp_visitas_v1';
let view='month', editId=null;

const $=id=>document.getElementById(id);
const norm=s=>String(s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,' ');

function load(){return JSON.parse(localStorage.getItem(LS)||'[]')}
function save(d){localStorage.setItem(LS,JSON.stringify(d))}
function uid(){return 'V'+Math.random().toString(36).slice(2,9)}

function render(){
  const all=load();
  const f=$('filterConsultor').value;
  const q=norm($('q').value);

  const list=all.filter(v=>{
    if(f && v.consultor!==f) return false;
    if(q && !norm(JSON.stringify(v)).includes(q)) return false;
    return true;
  });

  // KPIs
  const byCons={};
  list.forEach(v=>byCons[v.consultor]=(byCons[v.consultor]||0)+1);
  $('kpis').innerHTML=
    `<div class="kpi"><b>${list.length}</b>Visitas</div>`+
    Object.entries(byCons).map(([k,v])=>`<div class="kpi"><b>${v}</b>${k}</div>`).join('');

  // Calendar (lista inteligente)
  $('calendar').innerHTML=list
    .sort((a,b)=>(a.data+a.hora).localeCompare(b.data+b.hora))
    .map(v=>`
      <div class="event" onclick="edit('${v.id}')">
        <b>${new Date(v.data).toLocaleDateString('pt-PT')} ${v.hora}</b><br>
        ${v.cliente} · ${v.consultor}<br>
        <span class="small">${v.ref} · ${v.agencia||'—'}</span>
      </div>
    `).join('') || '<div class="small">Sem visitas</div>';
}

function edit(id){
  const v=load().find(x=>x.id===id);
  if(!v) return;
  editId=id;
  ['consultor','data','hora','cliente','ref','agencia','link']
    .forEach(k=>$(k).value=v[k]||'');
}

$('save').onclick=()=>{
  const rec={
    id:editId||uid(),
    consultor:$('consultor').value,
    data:$('data').value,
    hora:$('hora').value,
    cliente:$('cliente').value,
    ref:$('ref').value,
    agencia:$('agencia').value,
    link:$('link').value
  };
  let all=load().filter(v=>v.id!==rec.id);
  all.push(rec);
  save(all);
  editId=null;
  $('reset').click();
  render();
};

$('reset').onclick=()=>{
  editId=null;
  ['cliente','ref','agencia','link'].forEach(id=>$(id).value='');
};

document.querySelectorAll('.tab').forEach(t=>{
  t.onclick=()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    view=t.dataset.view;
    render();
  };
});

$('filterConsultor').onchange=render;
$('q').oninput=render;

render();
</script>

</body>
</html>
